-- Eternal Detector & Auto-Focus/Auto-Teleport
-- MODIFIKASI: Sistem Auto-Sell diubah & Panel Developer ditambahkan.
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local VirtualInputManager = game:GetService("VirtualInputManager")

local localPlayer = Players.LocalPlayer
local camera = workspace.CurrentCamera

-- ===================================================================
-- VARIABEL DAN PENGATURAN
-- ===================================================================

local autoFocus = true
local autoTeleport = true
local autoStart = true
local autoFly = true
local flying = false
local currentSpotIndex = nil
local lastTpTime = 0
local TP_COOLDOWN = 1.8

-- Status Penjualan Manual
local autoSellMythical = false
local autoSellEternal = false

local screenGui -- Referensi UI

local spots = {
    {name="Spot 1", pos=Vector3.new(-26.609,115.715,-285.779)},
    {name="Spot 2", pos=Vector3.new(-26.456,113.007,-154.013)},
    {name="Spot 3", pos=Vector3.new(-24.498,116.377,-2.832)},
}

local ETERNAL_NAMES = {
    SFish1 = "Loch Ness", SFish2 = "Skeleton",
    SFish3 = "Sea Elf", SFish4 = "Godzilla",
}

-- ===================================================================
-- FUNGSI UNTUK FITUR DEVELOPER
-- ===================================================================

local function instantKillAllFish(button)
    pcall(function()
        button.Text = "MEMPROSES..."
        button.BackgroundColor3 = Color3.fromRGB(255, 165, 0)

        local fishList = workspace:FindFirstChild("FishModelList")
        if not fishList then return end

        local allFishModels = {}
        for _, m in ipairs(fishList:GetChildren()) do
            if m:IsA("Model") then
                local hum = m:FindFirstChildOfClass("Humanoid")
                if hum and hum.Health > 0 then
                    table.insert(allFishModels, m)
                    hum.Health = 1
                end
            end
        end
        task.wait(0.1)

        local screenSize = workspace.CurrentCamera.ViewportSize
        local centerX = screenSize.X / 2
        local centerY = screenSize.Y / 2
        
        for _, fishModel in ipairs(allFishModels) do
            if fishModel and fishModel.PrimaryPart and fishModel.PrimaryPart:IsDescendantOf(workspace) then
                VirtualInputManager:SendMouseButtonEvent(centerX, centerY, 0, true, game, 0)
                VirtualInputManager:SendMouseButtonEvent(centerX, centerY, 0, false, game, 0)
                task.wait(0.05)
            end
        end

        button.Text = "Instant Kill All Fish"
        button.BackgroundColor3 = Color3.fromRGB(220, 20, 60)
    end)
end

local function setWeather(preset)
    local Lighting = game:GetService("Lighting")
    if preset == "Pagi" then
        Lighting.ClockTime = 8
        Lighting.Brightness = 2
        Lighting.FogEnd = 100000
        if Lighting:FindFirstChild("Atmosphere") then Lighting.Atmosphere:Destroy() end
    elseif preset == "Malam" then
        Lighting.ClockTime = 22
        Lighting.Brightness = 1
        Lighting.FogEnd = 5000
    elseif preset == "Mendung" then
        Lighting.ClockTime = 14
        Lighting.Brightness = 1.2
        Lighting.FogEnd = 2000
        if not Lighting:FindFirstChild("Atmosphere") then Instance.new("Atmosphere", Lighting) end
        Lighting.Atmosphere.Density = 0.4
        Lighting.Atmosphere.Haze = 1
        Lighting.Atmosphere.Color = Color3.fromRGB(125, 125, 125)
    end
    print("Cuaca diubah menjadi:", preset)
end

local function summonFish(fishName)
    if not fishName or fishName == "" then return end
    local fishList = workspace:FindFirstChild("FishModelList")
    local playerRoot = localPlayer.Character and localPlayer.Character:FindFirstChild("HumanoidRootPart")
    if not (fishList and playerRoot) then return end

    local targetFish = fishList:FindFirstChild(fishName)
    if targetFish and targetFish:IsA("Model") and targetFish.PrimaryPart then
        targetFish:SetPrimaryPartCFrame(playerRoot.CFrame * CFrame.new(0, 2, -15))
        print("Ikan '" .. fishName .. "' telah dipanggil.")
    else
        print("Ikan dengan nama '" .. fishName .. "' tidak ditemukan.")
    end
end

-- ===================================================================
-- FUNGSI INTI & PEMBUATAN UI
-- ===================================================================

local function getRoot()
    local character = localPlayer.Character or localPlayer.CharacterAdded:Wait()
    return character:WaitForChild("HumanoidRootPart")
end

local function sendAutoSellUpdate(rarityIndex, isEnabled)
    local ReplicatedStorage = game:GetService("ReplicatedStorage")
    local autoSellRemote = ReplicatedStorage:FindFirstChild("AutoSell")
    if autoSellRemote and autoSellRemote:FindFirstChild("Remote") then
        local remoteFunc = autoSellRemote.Remote:FindFirstChild("ApplyUpdateAutoSellData")
        if remoteFunc and remoteFunc:IsA("RemoteFunction") then
            pcall(function()
                remoteFunc:InvokeServer(rarityIndex, 1, isEnabled) -- Untuk Base
                remoteFunc:InvokeServer(rarityIndex, 2, isEnabled) -- Untuk Gold
            end)
        end
    end
end

local function buildUI()
    local pg = localPlayer:FindFirstChild("PlayerGui") or localPlayer:WaitForChild("PlayerGui")
    if screenGui then pcall(function() screenGui:Destroy() end) end

    screenGui = Instance.new("ScreenGui")
    screenGui.Name = "FishFarmUIV2"
    screenGui.ResetOnSpawn = false
    screenGui.Parent = pg

    local sidebarFrame = Instance.new("Frame")
    sidebarFrame.Size = UDim2.new(0, 320, 0, 450)
    sidebarFrame.Position = UDim2.new(0, 10, 0, 120)
    sidebarFrame.BackgroundColor3 = Color3.fromRGB(25,25,25)
    sidebarFrame.Parent = screenGui
    
    local sidebarHeader = Instance.new("Frame")
    sidebarHeader.Size = UDim2.new(1, 0, 0, 30)
    sidebarHeader.BackgroundColor3 = Color3.fromRGB(35,35,35)
    sidebarHeader.Parent = sidebarFrame

    local headerLabel = Instance.new("TextLabel")
    headerLabel.Size = UDim2.new(1, -60, 1, 0); headerLabel.Position = UDim2.new(0, 10, 0, 0); headerLabel.Text = "FISHING MENU"; headerLabel.TextColor3 = Color3.new(1,1,1); headerLabel.Font = Enum.Font.GothamBold; headerLabel.TextSize = 14; headerLabel.TextXAlignment = Enum.TextXAlignment.Left; headerLabel.BackgroundTransparency=1; headerLabel.Parent = sidebarHeader

    local minimizeBtn = Instance.new("TextButton")
    minimizeBtn.Size = UDim2.new(0, 25, 0, 25); minimizeBtn.Position = UDim2.new(1, -55, 0, 2.5); minimizeBtn.Text = "−"; minimizeBtn.Parent = sidebarHeader
    
    local sidebarCloseBtn = Instance.new("TextButton")
    sidebarCloseBtn.Size = UDim2.new(0, 25, 0, 25); sidebarCloseBtn.Position = UDim2.new(1, -28, 0, 2.5); sidebarCloseBtn.Text = "×"; sidebarCloseBtn.Parent = sidebarHeader

    do -- Draggable logic
        local dragging, dragStart, startPos
        sidebarHeader.InputBegan:Connect(function(input) if input.UserInputType == Enum.UserInputType.MouseButton1 then dragging = true; dragStart = input.Position; startPos = sidebarFrame.Position end end)
        sidebarHeader.InputEnded:Connect(function(input) if input.UserInputType == Enum.UserInputType.MouseButton1 then dragging = false end end)
        game:GetService("UserInputService").InputChanged:Connect(function(input) if dragging and input.UserInputType == Enum.UserInputType.MouseMovement then local delta = input.Position - dragStart; sidebarFrame.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y) end end)
    end

    local tabContainer = Instance.new("Frame")
    tabContainer.Size = UDim2.new(1, 0, 0, 35); tabContainer.Position = UDim2.new(0, 0, 0, 30); tabContainer.BackgroundColor3 = Color3.fromRGB(30,30,30); tabContainer.Parent = sidebarFrame
    
    local farmTab = Instance.new("TextButton")
    farmTab.Size = UDim2.new(0.333, 0, 1, 0); farmTab.Text = "Farm"; farmTab.Parent = tabContainer
    local sellTab = Instance.new("TextButton")
    sellTab.Size = UDim2.new(0.333, 0, 1, 0); sellTab.Position = UDim2.new(0.333, 0, 0, 0); sellTab.Text = "Sell"; sellTab.Parent = tabContainer
    local devTab = Instance.new("TextButton")
    devTab.Size = UDim2.new(0.333, 0, 1, 0); devTab.Position = UDim2.new(0.666, 0, 0, 0); devTab.Text = "Developer"; devTab.Parent = tabContainer

    local contentContainer = Instance.new("Frame")
    contentContainer.Size = UDim2.new(1, -10, 1, -70); contentContainer.Position = UDim2.new(0, 5, 0, 65); contentContainer.BackgroundTransparency = 1; contentContainer.Parent = sidebarFrame
    
    local farmContent = Instance.new("Frame"); farmContent.Size = UDim2.new(1,0,1,0); farmContent.BackgroundTransparency = 1; farmContent.Parent = contentContainer
    local sellContent = Instance.new("Frame"); sellContent.Size = UDim2.new(1,0,1,0); sellContent.BackgroundTransparency = 1; sellContent.Visible = false; sellContent.Parent = contentContainer
    local devContent = Instance.new("Frame"); devContent.Size = UDim2.new(1,0,1,0); devContent.BackgroundTransparency = 1; devContent.Visible = false; devContent.Parent = contentContainer

    -- Fungsi Ganti Tab
    local function switchTab(tabName)
        farmContent.Visible = (tabName == "farm")
        sellContent.Visible = (tabName == "sell")
        devContent.Visible = (tabName == "dev")
        farmTab.BackgroundColor3 = (tabName == "farm") and Color3.fromRGB(45,45,45) or Color3.fromRGB(30,30,30)
        sellTab.BackgroundColor3 = (tabName == "sell") and Color3.fromRGB(45,45,45) or Color3.fromRGB(30,30,30)
        devTab.BackgroundColor3 = (tabName == "dev") and Color3.fromRGB(45,45,45) or Color3.fromRGB(30,30,30)
    end
    farmTab.MouseButton1Click:Connect(function() switchTab("farm") end); sellTab.MouseButton1Click:Connect(function() switchTab("sell") end); devTab.MouseButton1Click:Connect(function() switchTab("dev") end)
    switchTab("farm")

    -- KONTEN TAB "SELL" (DIUBAH)
    local sellTitle = Instance.new("TextLabel"); sellTitle.Size=UDim2.new(1, -10, 0, 30); sellTitle.Position=UDim2.new(0,5,0,5); sellTitle.Text="Pengaturan Jual Manual"; sellTitle.Font=Enum.Font.GothamBold; sellTitle.TextSize=14; sellTitle.BackgroundTransparency=1; sellTitle.TextColor3=Color3.new(1,1,1); sellTitle.Parent = sellContent
    local autoSellInfo = Instance.new("TextLabel"); autoSellInfo.Size=UDim2.new(1, -10, 0, 40); autoSellInfo.Position=UDim2.new(0,5,0,35); autoSellInfo.Text="Note: Ikan Common s/d Legendary akan selalu dijual otomatis."; autoSellInfo.Font=Enum.Font.Gotham; autoSellInfo.TextSize=12; autoSellInfo.TextWrapped=true; autoSellInfo.BackgroundTransparency=1; autoSellInfo.TextColor3=Color3.fromRGB(180,180,180); autoSellInfo.Parent = sellContent
    
    local function createToggle(name, yPos, parent, callback)
        local button = Instance.new("TextButton"); button.Size = UDim2.new(1, -10, 0, 35); button.Position = UDim2.new(0, 5, 0, yPos); button.Text = name .. ": OFF"; button.Font = Enum.Font.Gotham; button.BackgroundColor3 = Color3.fromRGB(180,60,60); button.TextColor3 = Color3.new(1,1,1); button.Parent = parent
        local state = false
        button.MouseButton1Click:Connect(function()
            state = not state
            button.Text = name .. ": " .. (state and "ON" or "OFF")
            button.BackgroundColor3 = state and Color3.fromRGB(60,180,60) or Color3.fromRGB(180,60,60)
            callback(state)
        end)
    end
    
    createToggle("Jual Ikan MYTHICAL", 90, sellContent, function(state) autoSellMythical = state; sendAutoSellUpdate(6, state) end)
    createToggle("Jual Ikan ETERNAL", 135, sellContent, function(state) autoSellEternal = state; sendAutoSellUpdate(7, state) end)

    -- KONTEN TAB "DEVELOPER" (BARU)
    local devScroll = Instance.new("ScrollingFrame"); devScroll.Size = UDim2.new(1,0,1,0); devScroll.CanvasSize = UDim2.new(0,0,0,500); devScroll.BackgroundTransparency=1; devScroll.Parent = devContent
    local killBtn = Instance.new("TextButton"); killBtn.Size=UDim2.new(1,-10,0,40); killBtn.Position=UDim2.new(0,5,0,10); killBtn.Text="Instant Kill All Fish"; killBtn.BackgroundColor3=Color3.fromRGB(220,20,60); killBtn.Parent=devScroll
    killBtn.MouseButton1Click:Connect(function() instantKillAllFish(killBtn) end)
    
    local weatherLabel = Instance.new("TextLabel"); weatherLabel.Size=UDim2.new(1,-10,0,20); weatherLabel.Position=UDim2.new(0,5,0,60); weatherLabel.Text="Ubah Cuaca:"; weatherLabel.BackgroundTransparency=1; weatherLabel.TextColor3=Color3.new(1,1,1); weatherLabel.Parent=devScroll
    local pagiBtn = Instance.new("TextButton"); pagiBtn.Size=UDim2.new(0.33,-5,0,30); pagiBtn.Position=UDim2.new(0,5,0,85); pagiBtn.Text="Pagi"; pagiBtn.Parent=devScroll; pagiBtn.MouseButton1Click:Connect(function() setWeather("Pagi") end)
    local malamBtn = Instance.new("TextButton"); malamBtn.Size=UDim2.new(0.33,-5,0,30); malamBtn.Position=UDim2.new(0.33,5,0,85); malamBtn.Text="Malam"; malamBtn.Parent=devScroll; malamBtn.MouseButton1Click:Connect(function() setWeather("Malam") end)
    local mendungBtn = Instance.new("TextButton"); mendungBtn.Size=UDim2.new(0.33,-5,0,30); mendungBtn.Position=UDim2.new(0.66,5,0,85); mendungBtn.Text="Mendung"; mendungBtn.Parent=devScroll; mendungBtn.MouseButton1Click:Connect(function() setWeather("Mendung") end)
    
    local summonLabel = Instance.new("TextLabel"); summonLabel.Size=UDim2.new(1,-10,0,20); summonLabel.Position=UDim2.new(0,5,0,125); summonLabel.Text="Panggil Ikan:"; summonLabel.BackgroundTransparency=1; summonLabel.TextColor3=Color3.new(1,1,1); summonLabel.Parent=devScroll
    local fishNameInput = Instance.new("TextBox"); fishNameInput.Size=UDim2.new(0.65,-5,0,35); fishNameInput.Position=UDim2.new(0,5,0,150); fishNameInput.PlaceholderText="Nama Ikan..."; fishNameInput.Parent=devScroll
    local summonBtn = Instance.new("TextButton"); summonBtn.Size=UDim2.new(0.35,-5,0,35); summonBtn.Position=UDim2.new(0.65,5,0,150); summonBtn.Text="Panggil"; summonBtn.Parent=devScroll
    summonBtn.MouseButton1Click:Connect(function() summonFish(fishNameInput.Text) end)
    
    -- Inisialisasi Auto-Sell
    task.defer(function()
        for i = 1, 5 do -- Common sampai Legendary
            sendAutoSellUpdate(i, true)
        end
        sendAutoSellUpdate(6, autoSellMythical) -- Mythical (default OFF)
        sendAutoSellUpdate(7, autoSellEternal) -- Eternal (default OFF)
    end)
    
    -- ... (sisa kode UI, logika inti, dan loop utama tidak berubah)
end

-- Inisialisasi dan Loop Utama
pcall(buildUI)
print("Script dimuat dengan panel Developer dan sistem Auto-Sell baru.")

-- ... (seluruh sisa kode dari skrip asli untuk auto-target, fly, dll. tetap sama)
